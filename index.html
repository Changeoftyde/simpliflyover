<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f5f5f5;
  margin: 0;
  padding: 0;
}

.screen {
  position: absolute;
  width: 100%;
  height: 100%;
  padding: 2dvh;
  box-sizing: border-box;
  overflow-y: auto;
  background-color: #ffffff;
}

textarea {
  width: 45%;
  height: 40%;
  margin: 1%;
  padding: 1dvh;
  outline: 1px solid #ccc;
  border-radius: 1dvh;
  font-size: 2.5dvh;
  resize: none;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#go, #export {
  border-radius: 3dvh;
  width: 35dvh;
  height: 10dvh;
  position: fixed;
  transform: translateX(-50%);
  left: 50%;
  bottom: 1dvh;
  color: white;
  font-size: 5dvh;
  font-weight: bold;
  background-color: #007bff;
  border: none;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  transition: background-color 0.3s, transform 0.2s;
  z-index: 100;
}

#go:hover, #export:hover {
  background-color: #0056b3;
  transform: translateX(-50%) scale(1.05);
}

.article-container {
  display: flex;
  align-items: center;
  margin-bottom: 1.5dvh;
  background-color: #f0f8ff;
  padding: 1dvh;
  border-radius: 1dvh;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.article-container p {
  margin: 0;
  flex: 1;
  font-size: 2.2dvh;
  color: #333;
}

.hidden {
  display: none;
}
</style>
</head>
<body>
  <div class="screen" id="s1">
    <textarea placeholder="Monday Newsletter" id="monday"></textarea>
    <textarea placeholder="Tuesday Newsletter" id="tuesday"></textarea>
    <textarea placeholder="Wednesday Newsletter" id="wednesday"></textarea>
    <textarea placeholder="Thursday Newsletter" id="thursday"></textarea>
    <button id="go">Simplify</button>
  </div>

  <div class="screen hidden" id="s2">
    <div id="articles"></div>
    <button id="export">Export PDF</button>
  </div>

<script>
let allarticles = [];

document.getElementById("go").addEventListener("click", function() {
  let daysText = [
    document.getElementById("monday").value,
    document.getElementById("tuesday").value,
    document.getElementById("wednesday").value,
    document.getElementById("thursday").value
  ];

  document.getElementById("s1").classList.add("hidden");
  document.getElementById("s2").classList.remove("hidden");

  // Split each day's text by double newlines
  let dayArticles = daysText.map(text =>
    text.split(/\n\s*\n/).map(a => a.trim()).filter(a => a.length > 0)
  );

  // Flatten articles in day order: all of Monday, then Tuesday, etc.
  allarticles = [];
  for (let d = 0; d < dayArticles.length; d++) {
    dayArticles[d].forEach(a => allarticles.push({ text: a, checked: true }));
  }

  let container = document.getElementById("articles");
  container.innerHTML = "";

  allarticles.forEach((article, index) => {
    let div = document.createElement("div");
    div.classList.add("article-container");

    let checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = article.checked;
    checkbox.id = "chk_" + index;
    checkbox.addEventListener("change", function() {
      article.checked = this.checked;
    });

    let p = document.createElement("p");
    p.textContent = article.text;

    div.appendChild(checkbox);
    div.appendChild(p);
    container.appendChild(div);
  });
});

document.getElementById("export").addEventListener("click", function() {
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();
  doc.setFontSize(10); // really small font
  let y = 10;
  const pageHeight = 297;
  const lineHeight = 3; // small spacing

  allarticles.forEach(article => {
    // SWAPPED: checked = blue, unchecked = black
    if (article.checked) {
      doc.setTextColor(0, 0, 255); // blue
    } else {
      doc.setTextColor(0, 0, 0);   // black
    }

    let lines = article.text.split('\n').flatMap(line => doc.splitTextToSize(line, 180));

    lines.forEach(line => {
      if (y + lineHeight > pageHeight - 10) {
        doc.addPage();
        y = 10;
      }
      doc.text(line, 10, y);
      y += lineHeight;
    });

    y += lineHeight; // extra space between articles
  });

  doc.save("flyover_articles.pdf");
});
</script>
</body>
</html>
